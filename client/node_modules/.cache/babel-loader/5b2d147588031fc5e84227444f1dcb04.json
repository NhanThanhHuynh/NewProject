{"ast":null,"code":"import _regeneratorRuntime from\"/home/thanh/Desktop/Trackerlist/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/thanh/Desktop/Trackerlist/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/thanh/Desktop/Trackerlist/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{createContext,useReducer,useEffect}from\"react\";import{authReducer}from\"../reducers/Authreducer\";import axios from\"axios\";import{apiUrl,LOCAL_STORAGE_TOKEN_NAME}from\"./constants\";import setAuthtoken from\"./../utils/setAuthtoken\";import{jsx as _jsx}from\"react/jsx-runtime\";export var AuthContext=/*#__PURE__*/createContext();var AuthContextProvider=function AuthContextProvider(_ref){var children=_ref.children;var _useReducer=useReducer(authReducer,{authLoading:true,isAuthticated:false,user:null}),_useReducer2=_slicedToArray(_useReducer,2),authState=_useReducer2[0],dispatch=_useReducer2[1];//Auth user\nvar loadUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(localStorage[LOCAL_STORAGE_TOKEN_NAME]){setAuthtoken(localStorage[LOCAL_STORAGE_TOKEN_NAME]);}_context.prev=1;_context.next=4;return axios.get(\"\".concat(apiUrl,\"/auth\"));case 4:response=_context.sent;if(response.data.success){dispatch({type:\"SET_AUTH\",payload:{isAuthticated:true,user:response.data.user}});}_context.next=13;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);localStorage.removeItem(LOCAL_STORAGE_TOKEN_NAME);setAuthtoken(null);dispatch({type:\"SET_AUTH\",payload:{isAuthticated:false,user:null}});case 13:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function loadUser(){return _ref2.apply(this,arguments);};}();useEffect(function(){return loadUser();},[]);//Register\nvar registerUser=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(userForm){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post(\"\".concat(apiUrl,\"/auth/register\"),userForm);case 3:response=_context2.sent;if(response.data.success){localStorage.setItem(LOCAL_STORAGE_TOKEN_NAME,response.data.accessToken);}_context2.next=7;return loadUser();case 7:return _context2.abrupt(\"return\",response.data);case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);if(!_context2.t0.response.data){_context2.next=16;break;}return _context2.abrupt(\"return\",_context2.t0.response.data);case 16:return _context2.abrupt(\"return\",{success:false,messsage:_context2.t0.messsage});case 17:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));return function registerUser(_x){return _ref3.apply(this,arguments);};}();//Login\nvar loginUser=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(userForm){var response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return axios.post(\"\".concat(apiUrl,\"/auth/login\"),userForm);case 3:response=_context3.sent;if(response.data.success){localStorage.setItem(LOCAL_STORAGE_TOKEN_NAME,response.data.accessToken);}_context3.next=7;return loadUser();case 7:return _context3.abrupt(\"return\",response.data);case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](0);if(!_context3.t0.response.data){_context3.next=16;break;}return _context3.abrupt(\"return\",_context3.t0.response.data);case 16:return _context3.abrupt(\"return\",{success:false,messsage:_context3.t0.messsage});case 17:case\"end\":return _context3.stop();}}},_callee3,null,[[0,10]]);}));return function loginUser(_x2){return _ref4.apply(this,arguments);};}();//Logout\nvar logoutUser=function logoutUser(){localStorage.removeItem(LOCAL_STORAGE_TOKEN_NAME);dispatch({type:\"SET_AUTH\",payload:{isAuthticated:false,user:null}});};//context data\nvar authContextData={loginUser:loginUser,authState:authState,logoutUser:logoutUser,registerUser:registerUser};//return provider\nreturn/*#__PURE__*/_jsx(AuthContext.Provider,{value:authContextData,children:children});};export default AuthContextProvider;","map":{"version":3,"sources":["/home/thanh/Desktop/Trackerlist/client/src/contexts/index.js"],"names":["createContext","useReducer","useEffect","authReducer","axios","apiUrl","LOCAL_STORAGE_TOKEN_NAME","setAuthtoken","AuthContext","AuthContextProvider","children","authLoading","isAuthticated","user","authState","dispatch","loadUser","localStorage","get","response","data","success","type","payload","removeItem","registerUser","userForm","post","setItem","accessToken","messsage","loginUser","logoutUser","authContextData"],"mappings":"wWAAA,OAASA,aAAT,CAAwBC,UAAxB,CAAoCC,SAApC,KAAqD,OAArD,CACA,OAASC,WAAT,KAA4B,yBAA5B,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,MAAT,CAAiBC,wBAAjB,KAAiD,aAAjD,CACA,MAAOC,CAAAA,YAAP,KAAyB,yBAAzB,C,2CAEA,MAAO,IAAMC,CAAAA,WAAW,cAAGR,aAAa,EAAjC,CAEP,GAAMS,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,MAAkB,IAAfC,CAAAA,QAAe,MAAfA,QAAe,CAC5C,gBAA8BT,UAAU,CAACE,WAAD,CAAc,CACpDQ,WAAW,CAAE,IADuC,CAEpDC,aAAa,CAAE,KAFqC,CAGpDC,IAAI,CAAE,IAH8C,CAAd,CAAxC,4CAAOC,SAAP,iBAAkBC,QAAlB,iBAMA;AACA,GAAMC,CAAAA,QAAQ,2FAAG,gJACf,GAAIC,YAAY,CAACX,wBAAD,CAAhB,CAA4C,CAC1CC,YAAY,CAACU,YAAY,CAACX,wBAAD,CAAb,CAAZ,CACD,CAHc,sCAKUF,CAAAA,KAAK,CAACc,GAAN,WAAab,MAAb,UALV,QAKPc,QALO,eAMb,GAAIA,QAAQ,CAACC,IAAT,CAAcC,OAAlB,CAA2B,CACzBN,QAAQ,CAAC,CACPO,IAAI,CAAE,UADC,CAEPC,OAAO,CAAE,CAAEX,aAAa,CAAE,IAAjB,CAAuBC,IAAI,CAAEM,QAAQ,CAACC,IAAT,CAAcP,IAA3C,CAFF,CAAD,CAAR,CAID,CAXY,+EAabI,YAAY,CAACO,UAAb,CAAwBlB,wBAAxB,EACAC,YAAY,CAAC,IAAD,CAAZ,CACAQ,QAAQ,CAAC,CACPO,IAAI,CAAE,UADC,CAEPC,OAAO,CAAE,CAAEX,aAAa,CAAE,KAAjB,CAAwBC,IAAI,CAAE,IAA9B,CAFF,CAAD,CAAR,CAfa,oEAAH,kBAARG,CAAAA,QAAQ,2CAAd,CAsBAd,SAAS,CAAC,iBAAMc,CAAAA,QAAQ,EAAd,EAAD,CAAmB,EAAnB,CAAT,CAEA;AACA,GAAMS,CAAAA,YAAY,2FAAG,kBAAOC,QAAP,2KAEMtB,CAAAA,KAAK,CAACuB,IAAN,WAActB,MAAd,mBAAsCqB,QAAtC,CAFN,QAEXP,QAFW,gBAGjB,GAAIA,QAAQ,CAACC,IAAT,CAAcC,OAAlB,CAA2B,CACzBJ,YAAY,CAACW,OAAb,CACEtB,wBADF,CAEEa,QAAQ,CAACC,IAAT,CAAcS,WAFhB,EAID,CARgB,uBASXb,CAAAA,QAAQ,EATG,yCAUVG,QAAQ,CAACC,IAVC,mEAYb,aAAMD,QAAN,CAAeC,IAZF,4DAYe,aAAMD,QAAN,CAAeC,IAZ9B,2CAaL,CAAEC,OAAO,CAAE,KAAX,CAAkBS,QAAQ,CAAE,aAAMA,QAAlC,CAbK,yEAAH,kBAAZL,CAAAA,YAAY,6CAAlB,CAiBA;AACA,GAAMM,CAAAA,SAAS,2FAAG,kBAAOL,QAAP,2KAEStB,CAAAA,KAAK,CAACuB,IAAN,WAActB,MAAd,gBAAmCqB,QAAnC,CAFT,QAERP,QAFQ,gBAGd,GAAIA,QAAQ,CAACC,IAAT,CAAcC,OAAlB,CAA2B,CACzBJ,YAAY,CAACW,OAAb,CACEtB,wBADF,CAEEa,QAAQ,CAACC,IAAT,CAAcS,WAFhB,EAID,CARa,uBASRb,CAAAA,QAAQ,EATA,yCAUPG,QAAQ,CAACC,IAVF,mEAYV,aAAMD,QAAN,CAAeC,IAZL,4DAYkB,aAAMD,QAAN,CAAeC,IAZjC,2CAaF,CAAEC,OAAO,CAAE,KAAX,CAAkBS,QAAQ,CAAE,aAAMA,QAAlC,CAbE,yEAAH,kBAATC,CAAAA,SAAS,8CAAf,CAgBA;AACA,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAI,CACrBf,YAAY,CAACO,UAAb,CAAwBlB,wBAAxB,EACAS,QAAQ,CAAC,CACPO,IAAI,CAAE,UADC,CAEPC,OAAO,CAAE,CAAEX,aAAa,CAAE,KAAjB,CAAwBC,IAAI,CAAE,IAA9B,CAFF,CAAD,CAAR,CAID,CAND,CAOA;AACA,GAAMoB,CAAAA,eAAe,CAAG,CAAEF,SAAS,CAATA,SAAF,CAAajB,SAAS,CAATA,SAAb,CAAuBkB,UAAU,CAAVA,UAAvB,CAAkCP,YAAY,CAAZA,YAAlC,CAAxB,CACA;AACA,mBACE,KAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAEQ,eAA7B,UACGvB,QADH,EADF,CAKD,CAnFD,CAqFA,cAAeD,CAAAA,mBAAf","sourcesContent":["import { createContext, useReducer, useEffect } from \"react\";\nimport { authReducer } from \"../reducers/Authreducer\";\nimport axios from \"axios\";\nimport { apiUrl, LOCAL_STORAGE_TOKEN_NAME } from \"./constants\";\nimport setAuthtoken from \"./../utils/setAuthtoken\";\n\nexport const AuthContext = createContext();\n\nconst AuthContextProvider = ({ children }) => {\n  const [authState, dispatch] = useReducer(authReducer, {\n    authLoading: true,\n    isAuthticated: false,\n    user: null,\n  });\n\n  //Auth user\n  const loadUser = async () => {\n    if (localStorage[LOCAL_STORAGE_TOKEN_NAME]) {\n      setAuthtoken(localStorage[LOCAL_STORAGE_TOKEN_NAME]);\n    }\n    try {\n      const response = await axios.get(`${apiUrl}/auth`);\n      if (response.data.success) {\n        dispatch({\n          type: \"SET_AUTH\",\n          payload: { isAuthticated: true, user: response.data.user },\n        });\n      }\n    } catch (error) {\n      localStorage.removeItem(LOCAL_STORAGE_TOKEN_NAME);\n      setAuthtoken(null);\n      dispatch({\n        type: \"SET_AUTH\",\n        payload: { isAuthticated: false, user: null },\n      });\n    }\n  };\n\n  useEffect(() => loadUser(), []);\n  \n  //Register\n  const registerUser = async (userForm) => {\n    try {\n      const response = await axios.post(`${apiUrl}/auth/register`, userForm);\n      if (response.data.success) {\n        localStorage.setItem(\n          LOCAL_STORAGE_TOKEN_NAME,\n          response.data.accessToken\n        )\n      }\n      await loadUser()\n      return response.data;\n    } catch (error) {\n      if (error.response.data) return error.response.data;\n      else return { success: false, messsage: error.messsage };\n    }\n  };\n\n  //Login\n  const loginUser = async (userForm) => {\n    try {\n      const response = await axios.post(`${apiUrl}/auth/login`, userForm);\n      if (response.data.success) {\n        localStorage.setItem(\n          LOCAL_STORAGE_TOKEN_NAME,\n          response.data.accessToken\n        )\n      }\n      await loadUser()\n      return response.data;\n    } catch (error) {\n      if (error.response.data) return error.response.data;\n      else return { success: false, messsage: error.messsage };\n    }\n  };\n  //Logout\n  const logoutUser = ()=>{\n    localStorage.removeItem(LOCAL_STORAGE_TOKEN_NAME)\n    dispatch({\n      type: \"SET_AUTH\",\n      payload: { isAuthticated: false, user: null },\n    });\n  }\n  //context data\n  const authContextData = { loginUser, authState,logoutUser,registerUser };\n  //return provider\n  return (\n    <AuthContext.Provider value={authContextData}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContextProvider;\n"]},"metadata":{},"sourceType":"module"}